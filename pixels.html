<!DOCTYPE html>
<html>

<head>
    <title>Bitcoin UTXO Pixels</title>
    <script src="https://unpkg.com/vue@next"></script>
</head>

<body>
    <h1>Huh!</h1>
    <div id="utxo_image">
        <img src="img_0661045_compressed.png" v-on:mousemove="mouseOver" />
    </div>

    <script>
        const Handler = {
            data() {
                return {
                    counter: 0
                }
            },
            methods: {
                mouseOver(event) {
                    // data from buv.json - required to calculate a pixel's range
                    graphRect = [0, 10, 3720, 2072];
                    numBlocks = 661046;
                    minSatoshi = 1;
                    maxSatoshi = 1000000000000;

                    // get pixel
                    var imgX = event.pageX - event.target.x;
                    var imgY = event.pageY - event.target.y;

                    // check where in the plot we are
                    var plotX = imgX - graphRect[0];
                    var plotY = imgY - graphRect[1];
                    var plotWidth = graphRect[2];
                    var plotHeight = graphRect[3];
                    if (plotX < 0 || plotX > plotWidth || plotY < 0 || plotY > plotHeight) {
                        // not within range
                        return;
                    }

                    // reverse calculation of SatoshiBlockheightToPixel.blockheightToPixelWidth
                    // y = floor(k*x + d)
                    x1 = 0;
                    y1 = 0;
                    x2 = numBlocks - 1;
                    y2 = graphRect[2];
                    k = (y2 - y1) / (x2 - x1);
                    d = y1 - k * x1;

                    // x = (y - d) / k
                    var blockHeightLow = Math.ceil((plotX - d) / k);
                    var blockHeightHigh = Math.floor((plotX + 1 - d) / k);


                    // same for SatoshiBlockheightToPixel::satoshiToPixelHeight
                    // y = floor(k*x + d)
                    x1 = Math.log(maxSatoshi);
                    y1 = 0;
                    x2 = Math.log(minSatoshi);
                    y2 = graphRect[3];
                    k = (y2 - y1) / (x2 - x1);
                    d = y1 - k * x1;

                    // x = (y - d) / k
                    var satoshiHigh = Math.ceil(Math.exp((plotY - d) / k));
                    var satoshiLow = Math.floor(Math.exp((plotY + 1 - d) / k));

                    console.log("x=" + plotX + ", y=" + plotY + " blockHeight=" + blockHeightLow + " - " + blockHeightHigh + ", satoshi=" + satoshiLow + " - " + satoshiHigh);
                }
            }
        }

        Vue.createApp(Handler).mount('#utxo_image')

    </script>
</body>

</html>